import{c as u,r as t,G as b,w as M,j as e,B as m,t as R,y as F,z as L,X as T,v as q}from"./index-CvoPUybl.js";import{b as K,I as O}from"./input-DMosRNSl.js";import{B as C}from"./badge-GQmDJRT9.js";import{u as P}from"./useRealtime-Cu8CyKs1.js";import{M as k}from"./message-circle-YnBhlx1R.js";import{U}from"./user-C4_4m0Ko.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=u("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=u("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=u("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),J=({roomId:z,title:_="Chat Support",isSupport:E=!1})=>{const{user:a}=K(),[c,f]=t.useState(!1),[i,I]=t.useState(!1),[h,p]=t.useState([]),[d,g]=t.useState(""),[j,y]=t.useState(!1),[o,w]=t.useState(0),x=t.useRef(null),r=z||(E?`support:${a?.id}`:`general:${a?.id}`),v=t.useCallback(async()=>{if(!(!a||!r))try{const{data:s,error:n}=await b.from("messages").select("*").eq("room_id",r).order("created_at",{ascending:!0});if(n)throw n;p(s||[])}catch(s){console.error("Error fetching messages:",s),M({title:"Error",description:"Failed to load messages",variant:"destructive"})}},[a,r]);P("messages",s=>{s.new.room_id===r&&(p(n=>[...n,s.new]),(!c||i)&&w(n=>n+1))},void 0,void 0,`room_id=eq.${r}`),t.useEffect(()=>{a&&r&&v()},[a,r,v]),t.useEffect(()=>{x.current&&x.current.scrollIntoView({behavior:"smooth"})},[h]),t.useEffect(()=>{c&&!i&&w(0)},[c,i]);const N=async()=>{if(!(!d.trim()||!a||!r)){y(!0);try{const{error:s}=await b.from("messages").insert({room_id:r,sender_id:a.id,message:d.trim()});if(s)throw s;g("")}catch(s){console.error("Error sending message:",s),M({title:"Failed to send message",description:s.message||"Please try again",variant:"destructive"})}finally{y(!1)}}},B=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),N())},$=s=>s?new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",l=s=>s===a?.id;return a?e.jsxs(e.Fragment,{children:[!c&&e.jsxs(m,{onClick:()=>f(!0),className:"fixed bottom-6 right-6 z-50 rounded-full w-14 h-14 shadow-lg",size:"icon",children:[e.jsx(k,{className:"w-6 h-6"}),o>0&&e.jsx(C,{className:"absolute -top-2 -right-2 px-2 min-w-[20px] h-5 flex items-center justify-center text-xs bg-destructive text-destructive-foreground",children:o>99?"99+":o})]}),c&&e.jsxs(R,{className:`fixed bottom-6 right-6 z-50 w-80 shadow-xl transition-all duration-200 ${i?"h-16":"h-96"}`,children:[e.jsxs(F,{className:"p-3 pb-2 flex flex-row items-center justify-between",children:[e.jsxs(L,{className:"text-sm flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),_,o>0&&!i&&e.jsx(C,{variant:"destructive",className:"text-xs px-1.5 py-0.5",children:o})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>I(!i),children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>f(!1),children:e.jsx(T,{className:"w-4 h-4"})})]})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs(q,{className:"p-3 h-64 overflow-y-auto space-y-3",children:[h.length===0?e.jsxs("div",{className:"text-center text-muted-foreground text-sm py-8",children:[e.jsx(S,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-xs",children:"Start a conversation!"})]}):h.map(s=>e.jsx("div",{className:`flex ${l(s.sender_id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] px-3 py-2 rounded-lg text-sm ${l(s.sender_id)?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l(s.sender_id)?e.jsx(U,{className:"w-3 h-3"}):e.jsx(S,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs opacity-70",children:l(s.sender_id)?"You":"Support"})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:$(s.created_at)})]})},s.id)),e.jsx("div",{ref:x})]}),e.jsx("div",{className:"p-3 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:d,onChange:s=>g(s.target.value),onKeyPress:B,placeholder:"Type a message...",className:"text-sm",disabled:j}),e.jsx(m,{onClick:N,disabled:!d.trim()||j,size:"icon",className:"shrink-0",children:e.jsx(H,{className:"w-4 h-4"})})]})})]})]})]}):null};export{J as ChatWidget};
//# sourceMappingURL=ChatWidget-C4ZXfGHA.js.map
