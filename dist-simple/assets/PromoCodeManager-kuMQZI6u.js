import{c as Z,q as ee,r as a,j as e,t as S,v as A,y as te,B as r,z as se,E as ae,G as m,w as c}from"./index-CvoPUybl.js";import{I as D}from"./input-DMosRNSl.js";import{L as l}from"./label-D0-GUShF.js";import{B as u}from"./badge-GQmDJRT9.js";import{D as ie,d as re,a as ce,b as oe,c as ne}from"./dialog-BHKTKxbD.js";import{P as M,a as L,f as g,b as V,C as U}from"./popover-DlUZj04O.js";import{u as le}from"./useRealtime-Cu8CyKs1.js";import{A as de}from"./LazyComponents-r_KJFKA4.js";import{T as me}from"./tag-B-t4CA7g.js";import{P as ue,S as he,T as xe}from"./trash-2-DXPKM_Tb.js";import{P as ve}from"./percent-DLAlCB2a.js";import{I as pe}from"./indian-rupee-CPbtPu67.js";import{C as $}from"./index-ZOP8ASaN.js";import"./index-JvH1gesy.js";import"./index-zKAJ-H7_.js";import"./chevron-right-DkWL4jvt.js";import"./chevron-left-BAogtxRr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=Z("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Me=()=>{const q=ee(),[T,O]=a.useState([]),[z,B]=a.useState(!0),[R,h]=a.useState(!1),[x,E]=a.useState(null),[C,v]=a.useState(""),[n,p]=a.useState("percent"),[f,N]=a.useState(""),[o,y]=a.useState(),[d,w]=a.useState(),[P,b]=a.useState(""),[F,_]=a.useState(!0),j=async()=>{try{const{data:t,error:s}=await m.from("promo_codes").select("*").order("created_at",{ascending:!1});if(s)throw s;O(t||[])}catch(t){console.error("Error fetching promo codes:",t),c({title:"Error",description:"Failed to load promo codes",variant:"destructive"})}finally{B(!1)}};a.useEffect(()=>{j()},[]),le("promo_codes",()=>j(),()=>j(),()=>j());const I=()=>{v(""),p("percent"),N(""),y(void 0),w(void 0),b(""),_(!0),E(null)},G=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let s="";for(let i=0;i<8;i++)s+=t.charAt(Math.floor(Math.random()*t.length));v(s)},H=async t=>{if(t.preventDefault(),!C.trim()||!f){c({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}if(d&&o&&d<o){c({title:"Invalid Dates",description:"Valid to date must be after valid from date",variant:"destructive"});return}try{const s={code:C.trim().toUpperCase(),discount_percent:n==="percent"?parseInt(f):null,discount_flat:n==="flat"?parseFloat(f):null,valid_from:o?.toISOString().split("T")[0]||null,valid_to:d?.toISOString().split("T")[0]||null,usage_limit:P?parseInt(P):0,active:F};if(x){const{error:i}=await m.from("promo_codes").update(s).eq("id",x.id);if(i)throw i;c({title:"Promo Code Updated",description:"Promo code has been updated successfully"})}else{const{error:i}=await m.from("promo_codes").insert(s);if(i)throw i;c({title:"Promo Code Created",description:"New promo code has been created successfully"})}h(!1),I()}catch(s){console.error("Error saving promo code:",s),c({title:"Error",description:s?.message||"Failed to save promo code",variant:"destructive"})}},J=t=>{E(t),v(t.code),p(t.discount_percent?"percent":"flat"),N(String(t.discount_percent||t.discount_flat||"")),y(t.valid_from?new Date(t.valid_from):void 0),w(t.valid_to?new Date(t.valid_to):void 0),b(String(t.usage_limit||"")),_(t.active),h(!0)},K=async t=>{if(confirm("Are you sure you want to delete this promo code?"))try{const{error:s}=await m.from("promo_codes").delete().eq("id",t);if(s)throw s;c({title:"Promo Code Deleted",description:"Promo code has been deleted successfully"})}catch(s){console.error("Error deleting promo code:",s),c({title:"Error",description:"Failed to delete promo code",variant:"destructive"})}},Q=async t=>{try{const{error:s}=await m.from("promo_codes").update({active:!t.active}).eq("id",t.id);if(s)throw s;c({title:t.active?"Promo Code Deactivated":"Promo Code Activated",description:`Promo code ${t.code} has been ${t.active?"deactivated":"activated"}`})}catch(s){console.error("Error toggling promo code:",s),c({title:"Error",description:"Failed to update promo code status",variant:"destructive"})}},W=t=>{navigator.clipboard.writeText(t),c({title:"Copied to clipboard",description:`Code "${t}" copied to clipboard`})},X=t=>{if(!t.active)return e.jsx(u,{variant:"destructive",children:"Inactive"});const s=new Date,i=t.valid_from?new Date(t.valid_from):null,k=t.valid_to?new Date(t.valid_to):null;return i&&s<i?e.jsx(u,{variant:"outline",children:"Scheduled"}):k&&s>k?e.jsx(u,{variant:"secondary",children:"Expired"}):e.jsx(u,{className:"bg-success text-success-foreground",children:"Active"})},Y=t=>t.discount_percent?`${t.discount_percent}% off`:t.discount_flat?`₹${t.discount_flat} off`:"No discount";return z?e.jsx(S,{children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-muted rounded w-1/3"}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((t,s)=>e.jsx("div",{className:"h-16 bg-muted rounded"},s))})]})})}):e.jsxs(S,{children:[e.jsx(te,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{variant:"outline",size:"icon",onClick:()=>q("/admin"),className:"hover:bg-primary hover:text-primary-foreground transition-colors",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Promo Code Manager"]})]}),e.jsxs(ie,{open:R,onOpenChange:h,children:[e.jsx(re,{asChild:!0,children:e.jsxs(r,{onClick:I,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Create Promo Code"]})}),e.jsxs(ce,{className:"max-w-md",children:[e.jsx(oe,{children:e.jsx(ne,{children:x?"Edit Promo Code":"Create Promo Code"})}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"code",children:"Code *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{id:"code",value:C,onChange:t=>v(t.target.value.toUpperCase()),placeholder:"PROMO2024",required:!0}),e.jsx(r,{type:"button",variant:"outline",onClick:G,children:"Generate"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Discount Type *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"percent",checked:n==="percent",onChange:t=>p(t.target.value)}),e.jsx(ve,{className:"w-4 h-4"}),"Percentage"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"flat",checked:n==="flat",onChange:t=>p(t.target.value)}),e.jsx(pe,{className:"w-4 h-4"}),"Fixed Amount"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"discount",children:["Discount Value * ",n==="percent"?"(%)":"(₹)"]}),e.jsx(D,{id:"discount",type:"number",value:f,onChange:t=>N(t.target.value),placeholder:n==="percent"?"10":"100",min:"1",max:n==="percent"?"100":void 0,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Valid From"}),e.jsxs(M,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(r,{variant:"outline",className:"w-full justify-start",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),o?g(o,"PPP"):"Select date"]})}),e.jsx(V,{className:"w-auto p-0",children:e.jsx(U,{mode:"single",selected:o,onSelect:y})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Valid To"}),e.jsxs(M,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(r,{variant:"outline",className:"w-full justify-start",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),d?g(d,"PPP"):"Select date"]})}),e.jsx(V,{className:"w-auto p-0",children:e.jsx(U,{mode:"single",selected:d,onSelect:w,disabled:t=>o?t<o:!1})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"usage",children:"Usage Limit"}),e.jsx(D,{id:"usage",type:"number",value:P,onChange:t=>b(t.target.value),placeholder:"0 = unlimited",min:"0"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"active",checked:F,onChange:t=>_(t.target.checked)}),e.jsx(l,{htmlFor:"active",children:"Active"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>h(!1),className:"flex-1",children:"Cancel"}),e.jsx(r,{type:"submit",className:"flex-1",children:x?"Update":"Create"})]})]})]})]})]})}),e.jsx(A,{children:T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Promo Codes"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create promotional codes to offer discounts to your customers"})]}):e.jsx("div",{className:"space-y-4",children:T.map(t=>e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-mono font-bold text-lg",children:t.code}),X(t),e.jsx(u,{variant:"outline",children:Y(t)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Valid:"})," ",t.valid_from&&t.valid_to?`${g(new Date(t.valid_from),"MMM dd")} - ${g(new Date(t.valid_to),"MMM dd, yyyy")}`:"No expiry"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Usage:"})," ",t.usage_limit?`Limited to ${t.usage_limit}`:"Unlimited"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",size:"icon",onClick:()=>W(t.code),title:"Copy code",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(r,{variant:t.active?"outline":"default",size:"sm",onClick:()=>Q(t),children:t.active?"Deactivate":"Activate"}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>J(t),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>K(t.id),children:e.jsx(xe,{className:"w-4 h-4"})})]})]})},t.id))})})]})};export{Me as PromoCodeManager};
//# sourceMappingURL=PromoCodeManager-kuMQZI6u.js.map
