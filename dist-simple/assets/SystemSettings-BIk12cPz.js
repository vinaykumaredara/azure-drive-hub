import{c as U,r as n,h as B,p as q,j as e,d as J,k as M,i as V,x as G,a as N,q as W,G as k,w,B as C,t as _,y as E,z as P,v as R,s as X}from"./index-CvoPUybl.js";import{I}from"./input-DMosRNSl.js";import{L as $}from"./label-D0-GUShF.js";import{u as K}from"./index-ZOP8ASaN.js";import{A as Q,S as Y}from"./LazyComponents-r_KJFKA4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=U("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var j="Switch",[ee]=J(j),[te,se]=ee(j),T=n.forwardRef((c,u)=>{const{__scopeSwitch:o,name:m,checked:l,defaultChecked:g,required:p,disabled:i,value:h="on",onCheckedChange:f,form:d,...b}=c,[v,y]=n.useState(null),t=B(u,S=>y(S)),a=n.useRef(!1),r=v?d||!!v.closest("form"):!0,[s,x]=q({prop:l,defaultProp:g??!1,onChange:f,caller:j});return e.jsxs(te,{scope:o,checked:s,disabled:i,children:[e.jsx(M.button,{type:"button",role:"switch","aria-checked":s,"aria-required":p,"data-state":H(s),"data-disabled":i?"":void 0,disabled:i,value:h,...b,ref:t,onClick:V(c.onClick,S=>{x(D=>!D),r&&(a.current=S.isPropagationStopped(),a.current||S.stopPropagation())})}),r&&e.jsx(O,{control:v,bubbles:!a.current,name:m,value:h,checked:s,required:p,disabled:i,form:d,style:{transform:"translateX(-100%)"}})]})});T.displayName=j;var A="SwitchThumb",L=n.forwardRef((c,u)=>{const{__scopeSwitch:o,...m}=c,l=se(A,o);return e.jsx(M.span,{"data-state":H(l.checked),"data-disabled":l.disabled?"":void 0,...m,ref:u})});L.displayName=A;var ae="SwitchBubbleInput",O=n.forwardRef(({__scopeSwitch:c,control:u,checked:o,bubbles:m=!0,...l},g)=>{const p=n.useRef(null),i=B(p,g),h=K(o),f=G(u);return n.useEffect(()=>{const d=p.current;if(!d)return;const b=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(b,"checked").set;if(h!==o&&y){const t=new Event("click",{bubbles:m});y.call(d,o),d.dispatchEvent(t)}},[h,o,m]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...l,tabIndex:-1,ref:i,style:{...l.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});O.displayName=ae;function H(c){return c?"checked":"unchecked"}var F=T,re=L;const z=n.forwardRef(({className:c,...u},o)=>e.jsx(F,{className:N("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",c),...u,ref:o,children:e.jsx(re,{className:N("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));z.displayName=F.displayName;const de=()=>{const c=W(),[u,o]=n.useState({}),[m,l]=n.useState(!0),[g,p]=n.useState(!1),[i,h]=n.useState({}),f=n.useMemo(()=>[{key:"site_name",value:"RP Cars",description:"The name of the website",type:"string"},{key:"site_description",value:"Premium car rental service in India",description:"Site description for SEO",type:"string"},{key:"contact_email",value:"support@rpcars.in",description:"Primary contact email",type:"string"},{key:"contact_phone",value:"+91 9876543210",description:"Primary contact phone number",type:"string"},{key:"maintenance_mode",value:!1,description:"Enable maintenance mode",type:"boolean"},{key:"max_booking_days",value:30,description:"Maximum days a car can be booked",type:"number"},{key:"default_service_charge",value:500,description:"Default service charge in INR paise",type:"number"}],[]),d=n.useCallback(async()=>{try{const t={};f.forEach(s=>{t[s.key]=s.value});const{data:a,error:r}=await k.from("system_settings").select("*");r?console.warn("No system settings found, using defaults:",r):a?.forEach(s=>{try{t[s.key]=JSON.parse(s.value)}catch{t[s.key]=s.value}}),o(t),h(t)}catch(t){console.error("Error fetching settings:",t),w({title:"Error",description:"Failed to load system settings",variant:"destructive"})}finally{l(!1)}},[f]);n.useEffect(()=>{d()},[d]);const b=async()=>{p(!0);try{for(const t of Object.keys(i)){const a=f.find(x=>x.key===t);let r=i[t];a?.type==="number"?r=Number(r):a?.type==="boolean"&&(r=!!r);const{error:s}=await k.from("system_settings").upsert({key:t,value:JSON.stringify(r),updated_at:new Date().toISOString()},{onConflict:"key"});if(s)throw s}o(i),w({title:"Settings Saved",description:"System settings have been updated successfully"});try{await v("settings_update","System settings updated")}catch(t){console.warn("Failed to log audit action:",t)}}catch(t){console.error("Error saving settings:",t),w({title:"Error",description:"Failed to save system settings",variant:"destructive"})}finally{p(!1)}},v=async(t,a,r)=>{try{const{data:{user:s}}=await k.auth.getUser(),{error:x}=await k.from("audit_logs").insert({action:t,description:a,user_id:s?.id,metadata:{...r,timestamp:new Date().toISOString()}});x&&console.error("Error logging audit action:",x)}catch(s){console.error("Error logging audit action:",s)}},y=(t,a)=>{h(r=>({...r,[t]:a}))};return m?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{variant:"outline",size:"icon",onClick:()=>c("/admin"),className:"hover:bg-primary hover:text-primary-foreground transition-colors",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"System Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure global system settings"})]})]}),e.jsxs(_,{children:[e.jsx(E,{children:e.jsx(P,{children:"Configuration"})}),e.jsxs(R,{className:"space-y-6",children:[f.map(t=>e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row items-start md:items-center gap-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"font-medium",children:t.key}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description})]}),e.jsx("div",{className:"w-full md:w-64",children:t.type==="boolean"?e.jsx(z,{checked:i[t.key]??t.value,onCheckedChange:a=>y(t.key,a)}):t.type==="number"?e.jsx(I,{type:"number",value:i[t.key]??t.value,onChange:a=>y(t.key,a.target.value)}):e.jsx(I,{value:i[t.key]??t.value,onChange:a=>y(t.key,a.target.value)})})]},t.key)),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(C,{onClick:b,disabled:g,className:"flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4"}),"Save Settings"]})})})]})]}),e.jsxs(_,{children:[e.jsx(E,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"About System Settings"]})}),e.jsx(R,{children:e.jsx("p",{className:"text-muted-foreground",children:"These settings control the global behavior of the RP Cars system. Changes take effect immediately across the entire application."})})]})]})};export{de as default};
//# sourceMappingURL=SystemSettings-BIk12cPz.js.map
