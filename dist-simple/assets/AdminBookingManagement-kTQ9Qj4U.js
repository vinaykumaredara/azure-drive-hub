import{r as o,j as e,h as I,d as de,i as me,T as ue,a as p,U as M,q as pe,G as y,w as j,B as x,s as xe,t as ge,v as fe}from"./index-CvoPUybl.js";import{B as T}from"./badge-GQmDJRT9.js";import{u as he}from"./useRealtime-Cu8CyKs1.js";import{c as z,R as je,T as Ne,P as ve,W as ye,C as we,b as Ae,D as De,a as L,O as Ce}from"./index-JvH1gesy.js";import{I as _e}from"./ImageCarousel-CRNBMNzP.js";import{A as be}from"./LazyComponents-r_KJFKA4.js";import{C as Se}from"./car-CYTV7zau.js";import{U as Re}from"./user-C4_4m0Ko.js";import{D as P}from"./dollar-sign-CXmJJeNd.js";import{C as N}from"./circle-check-big-BwfNGwAL.js";import{C as w,R as B}from"./rotate-ccw-DrgAS65M.js";import{C as Ee}from"./clock-D7VWts-J.js";import{C as O}from"./index-ZOP8ASaN.js";import"./input-DMosRNSl.js";import"./index-zKAJ-H7_.js";import"./SimpleImage-BLRetY9C.js";var F="AlertDialog",[Te]=de(F,[z]),u=z(),H=t=>{const{__scopeAlertDialog:a,...r}=t,l=u(a);return e.jsx(je,{...l,...r,modal:!0})};H.displayName=F;var Pe="AlertDialogTrigger",U=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...l}=t,i=u(r);return e.jsx(Ne,{...i,...l,ref:a})});U.displayName=Pe;var Be="AlertDialogPortal",G=t=>{const{__scopeAlertDialog:a,...r}=t,l=u(a);return e.jsx(ve,{...l,...r})};G.displayName=Be;var Oe="AlertDialogOverlay",Y=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...l}=t,i=u(r);return e.jsx(Ce,{...i,...l,ref:a})});Y.displayName=Oe;var f="AlertDialogContent",[$e,ke]=Te(f),Ie=ue("AlertDialogContent"),q=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,children:l,...i}=t,c=u(r),g=o.useRef(null),v=I(a,g),h=o.useRef(null);return e.jsx(ye,{contentName:f,titleName:W,docsSlug:"alert-dialog",children:e.jsx($e,{scope:r,cancelRef:h,children:e.jsxs(we,{role:"alertdialog",...c,...i,ref:v,onOpenAutoFocus:me(i.onOpenAutoFocus,d=>{d.preventDefault(),h.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(Ie,{children:l}),e.jsx(ze,{contentRef:g})]})})})});q.displayName=f;var W="AlertDialogTitle",K=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...l}=t,i=u(r);return e.jsx(Ae,{...i,...l,ref:a})});K.displayName=W;var V="AlertDialogDescription",X=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...l}=t,i=u(r);return e.jsx(De,{...i,...l,ref:a})});X.displayName=V;var Me="AlertDialogAction",J=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...l}=t,i=u(r);return e.jsx(L,{...i,...l,ref:a})});J.displayName=Me;var Q="AlertDialogCancel",Z=o.forwardRef((t,a)=>{const{__scopeAlertDialog:r,...l}=t,{cancelRef:i}=ke(Q,r),c=u(r),g=I(a,i);return e.jsx(L,{...c,...l,ref:g})});Z.displayName=Q;var ze=({contentRef:t})=>{const a=`\`${f}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${f}\` by passing a \`${V}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${f}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(a)},[a,t]),null},Le=H,Fe=U,He=G,ee=Y,se=q,te=J,ae=Z,re=K,oe=X;const $=Le,k=Fe,Ue=He,le=o.forwardRef(({className:t,...a},r)=>e.jsx(ee,{className:p("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a,ref:r}));le.displayName=ee.displayName;const A=o.forwardRef(({className:t,...a},r)=>e.jsxs(Ue,{children:[e.jsx(le,{}),e.jsx(se,{ref:r,className:p("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a})]}));A.displayName=se.displayName;const D=({className:t,...a})=>e.jsx("div",{className:p("flex flex-col space-y-2 text-center sm:text-left",t),...a});D.displayName="AlertDialogHeader";const C=({className:t,...a})=>e.jsx("div",{className:p("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a});C.displayName="AlertDialogFooter";const _=o.forwardRef(({className:t,...a},r)=>e.jsx(re,{ref:r,className:p("text-lg font-semibold",t),...a}));_.displayName=re.displayName;const b=o.forwardRef(({className:t,...a},r)=>e.jsx(oe,{ref:r,className:p("text-sm text-muted-foreground",t),...a}));b.displayName=oe.displayName;const S=o.forwardRef(({className:t,...a},r)=>e.jsx(te,{ref:r,className:p(M(),t),...a}));S.displayName=te.displayName;const R=o.forwardRef(({className:t,...a},r)=>e.jsx(ae,{ref:r,className:p(M({variant:"outline"}),"mt-2 sm:mt-0",t),...a}));R.displayName=ae.displayName;const ls=()=>{const t=pe(),[a,r]=o.useState([]),[l,i]=o.useState(!0),[c,g]=o.useState("all");o.useEffect(()=>{v()},[]),he("bookings",s=>{r(n=>[...n,s.new])},s=>{r(n=>n.map(m=>m.id===s.new.id?s.new:m))},s=>{r(n=>n.filter(m=>m.id!==s.old.id))});const v=async()=>{try{const{data:s,error:n}=await y.from("bookings").select(`
          *,
          cars (
            title,
            make,
            model,
            image_urls
          ),
          users (
            full_name
          )
        `).order("created_at",{ascending:!1});if(n)throw n;r(s||[])}catch(s){console.error("Error fetching bookings:",s),j({title:"Error",description:"Failed to load bookings",variant:"destructive"})}finally{i(!1)}},h=async(s,n)=>{try{const{error:m}=await y.from("bookings").update({status:n}).eq("id",s);if(m)throw m;j({title:"Success",description:`Booking ${n} successfully`})}catch(m){console.error("Error updating booking:",m),j({title:"Error",description:"Failed to update booking",variant:"destructive"})}},d=async s=>{try{const{error:n}=await y.functions.invoke("cancel-booking",{body:{bookingId:s}});if(n)throw n;j({title:"Success",description:"Booking cancelled and refund initiated"})}catch(n){console.error("Error cancelling booking:",n),j({title:"Error",description:"Failed to cancel booking",variant:"destructive"})}},ie=s=>{switch(s){case"confirmed":return"bg-success text-success-foreground";case"pending":return"bg-warning text-warning-foreground";case"completed":return"bg-primary text-primary-foreground";case"cancelled":return"bg-destructive text-destructive-foreground";case"refunded":return"bg-muted text-muted-foreground";default:return"bg-muted text-muted-foreground"}},ne=s=>{switch(s){case"paid":return"bg-success text-success-foreground";case"partial_hold":return"bg-warning text-warning-foreground";case"unpaid":return"bg-destructive text-destructive-foreground";default:return"bg-muted text-muted-foreground"}},ce=s=>{switch(s){case"confirmed":return e.jsx(N,{className:"h-4 w-4"});case"completed":return e.jsx(N,{className:"h-4 w-4"});case"cancelled":return e.jsx(w,{className:"h-4 w-4"});case"refunded":return e.jsx(B,{className:"h-4 w-4"});default:return e.jsx(O,{className:"h-4 w-4"})}},E=a.filter(s=>c==="all"||s.status===c);return l?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{variant:"outline",size:"icon",onClick:()=>t("/admin"),className:"hover:bg-primary hover:text-primary-foreground transition-colors",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Booking Management"})]}),e.jsx("div",{className:"flex space-x-2",children:["all","pending","confirmed","completed","cancelled"].map(s=>e.jsx(x,{variant:c===s?"default":"outline",size:"sm",onClick:()=>g(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:E.map(s=>e.jsx(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(ge,{className:"hover:shadow-md transition-shadow",children:e.jsxs(fe,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center",children:s.cars?.image_urls&&s.cars.image_urls.length>0?e.jsx(_e,{images:s.cars.image_urls,className:"w-16 h-16 rounded"}):e.jsx("div",{className:"w-16 h-16 rounded bg-gray-100 flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 text-gray-400"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:s.cars?.title||"Car Booking"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.cars?.make," ",s.cars?.model]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx(Re,{className:"h-3 w-3 inline mr-1"}),s.users?.full_name||"Customer"]})]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(T,{className:ie(s.status),children:[ce(s.status),e.jsx("span",{className:"ml-1",children:s.status})]}),s.payment_status&&e.jsxs(T,{className:ne(s.payment_status),children:[e.jsx(P,{className:"h-3 w-3"}),e.jsx("span",{className:"ml-1",children:s.payment_status==="partial_hold"?"Hold":s.payment_status==="paid"?"Paid":"Unpaid"})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(s.start_datetime).toLocaleDateString()," - "," ",new Date(s.end_datetime).toLocaleDateString()]}),e.jsxs("p",{className:"font-semibold text-primary",children:[e.jsx(P,{className:"h-4 w-4 inline"}),s.total_amount]})]}),e.jsxs("div",{className:"flex space-x-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{size:"sm",onClick:()=>h(s.id,"confirmed"),children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),"Confirm"]}),e.jsxs($,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(x,{size:"sm",variant:"outline",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Cancel"]})}),e.jsxs(A,{children:[e.jsxs(D,{children:[e.jsx(_,{children:"Cancel Booking"}),e.jsx(b,{children:"Are you sure you want to cancel this booking? This action will initiate a refund process."})]}),e.jsxs(C,{children:[e.jsx(R,{children:"No, Keep Booking"}),e.jsx(S,{onClick:()=>d(s.id),children:"Yes, Cancel & Refund"})]})]})]})]}),s.status==="confirmed"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{size:"sm",onClick:()=>h(s.id,"completed"),children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),"Complete"]}),e.jsxs($,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(x,{size:"sm",variant:"outline",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Cancel"]})}),e.jsxs(A,{children:[e.jsxs(D,{children:[e.jsx(_,{children:"Cancel Booking"}),e.jsx(b,{children:"Are you sure you want to cancel this confirmed booking? This will initiate a refund."})]}),e.jsxs(C,{children:[e.jsx(R,{children:"No, Keep Booking"}),e.jsx(S,{onClick:()=>d(s.id),children:"Yes, Cancel & Refund"})]})]})]})]}),(s.status==="completed"||s.status==="cancelled")&&e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>d(s.id),children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Refund"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:[s.hold_until&&s.payment_status==="partial_hold"&&e.jsxs("div",{className:"p-3 bg-warning/10 rounded-lg flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-warning"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning",children:"Hold Active"}),e.jsxs("p",{className:"text-xs text-warning-foreground",children:["Expires: ",new Date(s.hold_until).toLocaleString()]})]})]}),s.hold_amount&&s.payment_status==="partial_hold"&&e.jsxs("div",{className:"p-3 bg-blue-100 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Hold Amount"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["â‚¹",s.hold_amount.toLocaleString()]})]})]})]})})},s.id))}),E.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:c==="all"?"No bookings yet":`No ${c} bookings`}),e.jsx("p",{className:"text-muted-foreground",children:c==="all"?"Bookings will appear here when customers make reservations":`No bookings with ${c} status found`})]})]})};export{ls as default};
//# sourceMappingURL=AdminBookingManagement-kTQ9Qj4U.js.map
