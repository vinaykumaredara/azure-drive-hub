import{q as R,Z,r as a,G as d,j as e,t as v,v as E,y as $,B as i,z as J,E as K}from"./index-CvoPUybl.js";import{B as N}from"./badge-GQmDJRT9.js";import{D as Q,d as V,a as X,b as Y,c as ee}from"./dialog-BHKTKxbD.js";import{L as h}from"./label-D0-GUShF.js";import{T as se}from"./textarea-AIHptgKh.js";import{P as M,a as k,f as u,b as _,C as I}from"./popover-DlUZj04O.js";import{A as te}from"./LazyComponents-r_KJFKA4.js";import{W as ae}from"./wrench-DWM7VfdE.js";import{P as re,S as ne,T as ie}from"./trash-2-DXPKM_Tb.js";import{C as T}from"./index-ZOP8ASaN.js";import"./index-JvH1gesy.js";import"./input-DMosRNSl.js";import"./index-zKAJ-H7_.js";import"./chevron-right-DkWL4jvt.js";import"./chevron-left-BAogtxRr.js";const Se=()=>{const q=R(),{toast:r}=Z(),[w,F]=a.useState([]),[A,B]=a.useState([]),[L,S]=a.useState(!0),[O,o]=a.useState(!1),[m,y]=a.useState(null),[x,j]=a.useState(""),[c,f]=a.useState(),[l,p]=a.useState(),[C,g]=a.useState(""),D=a.useCallback(async()=>{try{const{data:s,error:t}=await d.from("maintenance").select(`
          *,
          cars (
            title,
            make,
            model
          )
        `).order("start_date",{ascending:!0});if(t)throw t;F(s||[])}catch(s){console.error("Error fetching maintenances:",s),r({title:"Error",description:"Failed to load maintenance schedules",variant:"destructive"})}},[r]),b=a.useCallback(async()=>{try{const{data:s,error:t}=await d.from("cars").select("id, title, make, model").eq("status","active").order("title");if(t)throw t;B(s||[])}catch(s){console.error("Error fetching cars:",s)}},[]);a.useEffect(()=>{(async()=>{S(!0),await Promise.all([D(),b()]),S(!1)})()},[D,b]);const P=()=>{j(""),f(void 0),p(void 0),g(""),y(null)},z=async s=>{if(s.preventDefault(),!x||!c||!l){r({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}if(l<c){r({title:"Invalid Dates",description:"End date must be after start date",variant:"destructive"});return}try{const t={car_id:x,start_date:c.toISOString(),end_date:l.toISOString(),notes:C.trim()};if(m){const{error:n}=await d.from("maintenance").update(t).eq("id",m.id);if(n)throw n;r({title:"Maintenance Updated",description:"Maintenance schedule has been updated successfully"})}else{const{error:n}=await d.from("maintenance").insert(t);if(n)throw n;r({title:"Maintenance Scheduled",description:"New maintenance has been scheduled successfully"})}o(!1),P()}catch(t){console.error("Error saving maintenance:",t),r({title:"Error",description:t.message||"Failed to save maintenance schedule",variant:"destructive"})}},U=s=>{y(s),j(s.car_id||""),f(new Date(s.start_date)),p(new Date(s.end_date)),g(s.notes||""),o(!0)},H=async s=>{if(confirm("Are you sure you want to delete this maintenance schedule?"))try{const{error:t}=await d.from("maintenance").delete().eq("id",s);if(t)throw t;r({title:"Maintenance Deleted",description:"Maintenance schedule has been deleted successfully"})}catch(t){console.error("Error deleting maintenance:",t),r({title:"Error",description:"Failed to delete maintenance schedule",variant:"destructive"})}},W=s=>{const t=new Date,n=new Date(s.start_date),G=new Date(s.end_date);return t<n?e.jsx(N,{variant:"outline",children:"Scheduled"}):t>=n&&t<=G?e.jsx(N,{className:"bg-warning text-warning-foreground",children:"In Progress"}):e.jsx(N,{className:"bg-success text-success-foreground",children:"Completed"})};return L?e.jsx(v,{children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-muted rounded w-1/3"}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,t)=>e.jsx("div",{className:"h-16 bg-muted rounded"},t))})]})})}):e.jsxs(v,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"outline",size:"icon",onClick:()=>q("/admin"),className:"hover:bg-primary hover:text-primary-foreground transition-colors",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Maintenance Scheduler"]})]}),e.jsxs(Q,{open:O,onOpenChange:o,children:[e.jsx(V,{asChild:!0,children:e.jsxs(i,{onClick:P,children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Schedule Maintenance"]})}),e.jsxs(X,{className:"max-w-md",children:[e.jsx(Y,{children:e.jsx(ee,{children:m?"Edit Maintenance":"Schedule Maintenance"})}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"car",children:"Car *"}),e.jsxs("select",{id:"car",value:x,onChange:s=>j(s.target.value),className:"w-full p-2 border rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select a car"}),A.map(s=>e.jsxs("option",{value:s.id,children:[s.title," - ",s.make," ",s.model]},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Start Date *"}),e.jsxs(M,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),c?u(c,"PPP"):"Select date"]})}),e.jsx(_,{className:"w-auto p-0",children:e.jsx(I,{mode:"single",selected:c,onSelect:f,disabled:s=>s<new Date})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"End Date *"}),e.jsxs(M,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),l?u(l,"PPP"):"Select date"]})}),e.jsx(_,{className:"w-auto p-0",children:e.jsx(I,{mode:"single",selected:l,onSelect:p,disabled:s=>s<(c||new Date)})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"notes",children:"Notes"}),e.jsx(se,{id:"notes",value:C,onChange:s=>g(s.target.value),placeholder:"Maintenance details, parts needed, etc.",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"Cancel"}),e.jsx(i,{type:"submit",className:"flex-1",children:m?"Update":"Schedule"})]})]})]})]})]})}),e.jsx(E,{children:w.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Maintenance Scheduled"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Schedule maintenance to keep your fleet in top condition"})]}):e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.cars?.title||"Unknown Car"}),W(s)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start:"})," ",u(new Date(s.start_date),"PPP")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End:"})," ",u(new Date(s.end_date),"PPP")]})]}),s.notes&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"outline",size:"icon",onClick:()=>U(s),children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>H(s.id),children:e.jsx(ie,{className:"w-4 h-4"})})]})]})},s.id))})})]})};export{Se as MaintenanceScheduler};
//# sourceMappingURL=MaintenanceScheduler-Dapsc5M8.js.map
