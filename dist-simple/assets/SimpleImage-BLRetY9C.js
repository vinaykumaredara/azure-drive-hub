import{r as n,j as a}from"./index-CvoPUybl.js";const h=new Map,d=new Map,y="https://images.unsplash.com/photo-1494905998402-395d579af36f?w=800&h=600&fit=crop&crop=center&auto=format&q=80";function C(e){return d.has(e)?Promise.resolve(d.get(e)):new Promise((t,o)=>{const r=new Image;r.onload=()=>{d.set(e,r),t(r)},r.onerror=o,r.src=e})}function b(e){if(!e||typeof e!="string"||e.trim()==="")return y;if(h.has(e))return h.get(e);let t;return e.startsWith("http://")||e.startsWith("https://")?t=e:t=`https://rcpkhtlvfvafympulywx.supabase.co/storage/v1/object/public/cars-photos/${e}`,h.set(e,t),t}function S(e){if(!e)return e;const t=Array.isArray(e?.image_paths)&&e.image_paths.length>0?e.image_paths:[],o=Array.isArray(e?.image_urls)&&e.image_urls.length>0?e.image_urls.map(b):t.length>0?t.map(b):[],r=Array.isArray(o)&&o.length>0?o:[y],i=typeof r[0]=="string"&&r[0].length>0?r[0]:y;return{...e,image_paths:t,image_urls:o,images:r,thumbnail:i}}function F(e){return S(e)}const $="https://images.unsplash.com/photo-1494905998402-395d579af36f?w=800&h=600&fit=crop&crop=center&auto=format&q=80";function M({src:e,alt:t,placeholder:o,aspectRatio:r,fallback:i,className:v="",debug:c=!1,lazy:m=!0,...x}){const[_,A]=n.useState(!1),[p,I]=n.useState(!1),[g,L]=n.useState(!m),l=n.useRef(null),u=n.useRef(null),s=b(e);n.useEffect(()=>{c&&console.log("LazyImage - Props:",{src:e,alt:t,resolvedSrc:s})},[e,t,s,c]),n.useEffect(()=>{if(!(!m||!l.current))return u.current=new IntersectionObserver(([f])=>{f.isIntersecting&&(L(!0),u.current?.disconnect())},{rootMargin:"50px",threshold:.01}),l.current&&u.current.observe(l.current),()=>{u.current&&u.current.disconnect()}},[m]),n.useEffect(()=>{if(!g||!s)return;let f=!0;return C(s).then(()=>{f&&I(!0)}).catch(()=>{f&&A(!0)}),()=>{f=!1}},[g,s]);const w={position:"relative",overflow:"hidden",...r?{aspectRatio:r}:{width:"100%",height:"auto"}},j=()=>{c&&console.log("Image failed to load",s),A(!0)},E=_||!s?i||$:s;return!p&&g?a.jsxs("div",{style:w,className:"bg-gray-100",children:[a.jsx("img",{ref:l,src:E,alt:t,onError:j,onLoad:()=>I(!0),className:`${v} block w-full h-full object-cover ${p?"opacity-100":"opacity-0"} transition-opacity duration-300`,...x}),c&&s&&a.jsx("div",{className:"text-xs p-1 bg-gray-100 break-all",children:s})]}):a.jsxs("div",{style:w,className:"bg-gray-100",children:[a.jsx("img",{ref:l,src:E,alt:t,onError:j,className:`${v} block w-full h-full object-cover ${p?"opacity-100":"opacity-0"} transition-opacity duration-300`,...x}),c&&s&&a.jsx("div",{className:"text-xs p-1 bg-gray-100 break-all",children:s})]})}const k="https://images.unsplash.com/photo-1494905998402-395d579af36f?w=800&h=600&fit=crop&crop=center&auto=format&q=80";function R({src:e,alt:t,className:o="",lazy:r=!0,...i}){return a.jsx(M,{src:e,alt:t,className:o,lazy:r,fallback:k,...i})}export{R as S,F as m,b as r,S as s};
//# sourceMappingURL=SimpleImage-BLRetY9C.js.map
