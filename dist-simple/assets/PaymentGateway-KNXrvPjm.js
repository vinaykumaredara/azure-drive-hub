import{c as A,r as h,j as e,t as y,v as u,y as H,z as Y,B as g,s as N,X as M,w as S,G as o}from"./index-CvoPUybl.js";import{L as U}from"./label-D0-GUShF.js";import{S as P}from"./separator-CVbJ09D4.js";import{B as C}from"./badge-GQmDJRT9.js";import{D as q,a as W,b as X,c as J}from"./dialog-BHKTKxbD.js";import{b as K}from"./input-DMosRNSl.js";import{C as f}from"./check-C6nFDVMd.js";import{S as z}from"./shield-DC0ZORfi.js";import{L as Q}from"./loader-circle-DZ0-E_u0.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=A("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),V=({isOpen:_,onClose:d,bookingData:s,onSuccess:v})=>{const{user:l}=K(),[n,b]=h.useState("razorpay"),[j,m]=h.useState(!1),[x,c]=h.useState("details"),[Z,T]=h.useState(null),I=async()=>{try{const r=new Date(`${s.startDate}T${s.startTime}:00`),a=new Date(`${s.endDate}T${s.endTime}:00`),{data:t,error:i}=await o.from("bookings").insert({user_id:l?.id,car_id:s.carId,start_datetime:r.toISOString(),end_datetime:a.toISOString(),total_amount:s.total,status:"pending"}).select().single();if(i)throw i;return t.id}catch(r){throw console.error("Booking creation error:",r),r}},R=()=>new Promise((r,a)=>{if(window.Razorpay){r(!0);return}const t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>r(!0),t.onerror=()=>a(!1),document.body.appendChild(t)}),B=async r=>{try{await R();const{data:{session:a},error:t}=await o.functions.invoke("create-payment",{body:{bookingId:r,gateway:"razorpay",amount:s.total}});if(t)throw t;const i={key:"rzp_test_11111111111111",amount:s.total*100,currency:"INR",name:"Azure Drive Hub",description:`Car Rental: ${s.carTitle}`,image:"/logo.png",order_id:a.sessionId,handler:async O=>{try{const{error:p}=await o.functions.invoke("confirm-payment",{body:{payment_intent_id:O.razorpay_payment_id,status:"succeeded"}});if(p)throw p;c("success"),setTimeout(()=>{v(r),d()},2e3)}catch(p){console.error("Payment confirmation error:",p),c("failed")}},prefill:{name:l?.user_metadata?.full_name||"",email:l?.email||"",contact:l?.user_metadata?.phone||""},notes:{booking_id:r,car_id:s.carId},theme:{color:"#3366FF"},modal:{ondismiss:()=>{m(!1),c("details")}}};new window.Razorpay(i).open()}catch(a){throw console.error("Razorpay payment error:",a),a}},L=async r=>{try{const{data:a,error:t}=await o.functions.invoke("create-payment-intent",{body:{bookingId:r,gateway:"stripe"}});if(t)throw t;setTimeout(async()=>{try{const{error:i}=await o.functions.invoke("confirm-payment",{body:{payment_intent_id:a.payment_intent_id,status:"succeeded"}});if(i)throw i;c("success"),setTimeout(()=>{v(r),d()},2e3)}catch(i){console.error("Payment confirmation error:",i),c("failed")}},3e3)}catch(a){throw console.error("Stripe payment error:",a),a}},F=async()=>{if(!l){S({title:"Authentication Required",description:"Please sign in to complete your booking",variant:"destructive"});return}try{m(!0),c("processing");const r=await I();T(r),n==="razorpay"?await B(r):await L(r)}catch(r){console.error("Payment processing error:",r),c("failed"),S({title:"Payment Failed",description:"There was an error processing your payment. Please try again.",variant:"destructive"})}finally{m(!1)}},$=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(U,{className:"text-base font-semibold",children:"Select Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(y,{className:`cursor-pointer transition-all ${n==="razorpay"?"ring-2 ring-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>b("razorpay"),children:e.jsx(u,{className:"p-4 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-blue-600"})}),e.jsx("h3",{className:"font-semibold",children:"Razorpay"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"UPI, Cards, Net Banking"}),n==="razorpay"&&e.jsxs(C,{className:"bg-primary text-primary-foreground",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Selected"]})]})})}),e.jsx(y,{className:`cursor-pointer transition-all ${n==="stripe"?"ring-2 ring-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>b("stripe"),children:e.jsx(u,{className:"p-4 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"w-6 h-6 text-purple-600"})}),e.jsx("h3",{className:"font-semibold",children:"Stripe"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"International Cards"}),n==="stripe"&&e.jsxs(C,{className:"bg-primary text-primary-foreground",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Selected"]})]})})})]})]}),e.jsxs(y,{children:[e.jsx(H,{children:e.jsx(Y,{className:"text-lg",children:"Booking Summary"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:s.carImage,alt:s.carTitle,className:"w-20 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:s.carTitle}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.startDate," ",s.startTime," → ",s.endDate," ",s.endTime]}),e.jsxs("p",{className:"text-sm text-primary font-medium",children:[s.duration.billingHours," hours (",s.duration.days," day",s.duration.days!==1?"s":"",")"]})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",s.subtotal.toLocaleString()]})]}),s.serviceCharge>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Service Charge"}),e.jsxs("span",{children:["₹",s.serviceCharge.toLocaleString()]})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["₹",s.total.toLocaleString()]})]})]})]})]}),e.jsx(y,{className:"border-dashed border-primary/30",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium text-primary mb-1",children:"Secure Payment Process"}),e.jsxs("ul",{className:"text-muted-foreground space-y-1 text-xs",children:[e.jsxs("li",{children:['• Click "Pay Now" to proceed to ',n==="razorpay"?"Razorpay":"Stripe"," secure checkout"]}),e.jsx("li",{children:"• Your booking will be confirmed after successful payment"}),e.jsx("li",{children:"• You'll receive confirmation details via email"})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[n==="razorpay"?"Razorpay":"Stripe"," selected"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n==="razorpay"?"UPI, Cards, Net Banking & Wallets available":"International cards accepted"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{variant:"outline",onClick:d,className:"flex-1",disabled:j,children:"Cancel"}),e.jsx(g,{onClick:F,className:"flex-1 bg-gradient-to-r from-primary to-primary-dark hover:from-primary-dark hover:to-primary text-white font-semibold py-2 px-6 shadow-lg hover:shadow-xl transition-all duration-200",disabled:j,size:"lg",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-5 h-5 mr-2"}),"Pay Now ₹",s.total.toLocaleString()]})})]})]})]}),k=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Processing Payment"}),e.jsx("p",{className:"text-muted-foreground",children:"Please do not close this window..."})]}),E=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N.div,{initial:{scale:0},animate:{scale:1},className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-green-600",children:"Payment Successful!"}),e.jsx("p",{className:"text-muted-foreground",children:"Your booking has been confirmed. Redirecting..."})]}),G=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N.div,{initial:{scale:0},animate:{scale:1},className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-red-600",children:"Payment Failed"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"There was an issue processing your payment"}),e.jsx(g,{onClick:()=>{c("details"),m(!1)},children:"Try Again"})]});return e.jsx(q,{open:_,onOpenChange:d,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsx(X,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Complete Payment"]})}),x==="details"&&$(),x==="processing"&&k(),x==="success"&&E(),x==="failed"&&G()]})})},oe=Object.freeze(Object.defineProperty({__proto__:null,PaymentGateway:V},Symbol.toStringTag,{value:"Module"}));export{w as C,V as P,oe as a};
//# sourceMappingURL=PaymentGateway-KNXrvPjm.js.map
