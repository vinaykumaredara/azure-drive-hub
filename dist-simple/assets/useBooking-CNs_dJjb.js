import{c as d,q as k,r as c,w as i,G as l}from"./index-CvoPUybl.js";import{b as p}from"./input-DMosRNSl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=d("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=d("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),I=()=>{const{user:n}=p(),g=k(),[u,s]=c.useState(null);c.useEffect(()=>{const e=sessionStorage.getItem("pendingBooking");if(e)try{const r=JSON.parse(e);s(r)}catch(r){console.error("Failed to parse pending booking:",r),sessionStorage.removeItem("pendingBooking")}},[]);const a=(e,r={})=>{sessionStorage.setItem("pendingBooking",JSON.stringify(e)),console.log("saveDraftAndRedirect called:",{draft:e,options:r}),r.redirectToProfile&&sessionStorage.setItem("redirectToProfileAfterLogin","true"),g(`/auth?next=${encodeURIComponent(window.location.pathname)}`)};return{pendingBooking:u,saveDraftAndRedirect:a,clearDraft:()=>{sessionStorage.removeItem("pendingBooking"),sessionStorage.removeItem("redirectToProfileAfterLogin"),s(null)},checkLicenseStatus:async()=>{if(!n)return!1;try{const{data:e,error:r}=await l.from("licenses").select("id, verified").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(1);if(r)throw r;return e&&e.length>0&&e[0].verified}catch(e){return console.error("License check error:",e),i({title:"Error",description:"Failed to check license status",variant:"destructive"}),!1}},createBookingHold:async(e,r)=>{if(!n)return a(e),null;if(!e.carId||!e.pickup?.date||!e.pickup?.time||!e.return?.date||!e.return?.time){const o=new Error("Missing required booking information. Please fill in all date and time fields.");return console.error("Create booking hold validation error:",o),i({title:"Validation Error",description:o.message,variant:"destructive"}),null}try{const{data:o,error:t}=await l.functions.invoke("create-hold",{body:{carId:e.carId,pickup:e.pickup,return:e.return,addons:e.addons,totals:e.totals,payMode:r}});if(t)throw t;if(!o.success)throw new Error(o.error||"Failed to create booking hold");return i({title:"Booking Hold Created",description:r==="hold"?"Your booking is reserved for 24 hours. Complete payment within this time.":"Booking created successfully."}),o}catch(o){console.error("Create booking hold error:",o);const t=o?.message||"Failed to create booking. Please try again.";return i({title:"Booking Failed",description:t,variant:"destructive"}),null}}}};export{w as C,B as M,I as u};
//# sourceMappingURL=useBooking-CNs_dJjb.js.map
