{"version":3,"file":"LicenseUpload-QKeESwn2.js","sources":["../../src/components/LicenseUpload.tsx"],"sourcesContent":["import { useState, useRef } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Upload, FileText, Loader2 } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/components/AuthProvider\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\n\r\ninterface LicenseUploadProps {\r\n  onUploaded: (licenseId: string) => void;\r\n}\r\n\r\nexport const LicenseUpload: React.FC<LicenseUploadProps> = ({ onUploaded }) => {\r\n  const { user } = useAuth();\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFile = e.target.files?.[0];\r\n    if (selectedFile) {\r\n      // Validate file type\r\n      if (!selectedFile.type.startsWith(\"image/\") && selectedFile.type !== \"application/pdf\") {\r\n        toast({\r\n          title: \"Invalid File\",\r\n          description: \"Please select an image file or PDF\",\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      // Validate file size (max 5MB)\r\n      if (selectedFile.size > 5 * 1024 * 1024) {\r\n        toast({\r\n          title: \"File Too Large\",\r\n          description: \"Please select a file smaller than 5MB\",\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      setFile(selectedFile);\r\n    }\r\n  };\r\n\r\n  const handleUpload = async () => {\r\n    if (!file || !user) {return;}\r\n\r\n    setIsUploading(true);\r\n\r\n    try {\r\n      // Upload file to Supabase Storage\r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `${user.id}/${Date.now()}.${fileExt}`;\r\n      const filePath = `licenses/${fileName}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('license-uploads')\r\n        .upload(filePath, file, { upsert: false });\r\n\r\n      if (uploadError) {throw uploadError;}\r\n\r\n      // Create license record in database\r\n      const { data: license, error: insertError } = await (supabase\r\n        .from('licenses') as any)\r\n        .insert({\r\n          user_id: user.id,\r\n          storage_path: filePath,\r\n          verified: false\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) {\r\n        // Rollback file upload if database insert fails\r\n        await supabase.storage.from('license-uploads').remove([filePath]);\r\n        throw insertError;\r\n      }\r\n\r\n      toast({\r\n        title: \"License Uploaded Successfully!\",\r\n        description: \"Your license has been uploaded and is awaiting admin verification.\",\r\n      });\r\n\r\n      // Notify parent component\r\n      onUploaded((license as any).id);\r\n\r\n      // Clear file input\r\n      setFile(null);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = \"\";\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error(\"Upload error:\", error);\r\n      toast({\r\n        title: \"Upload Failed\",\r\n        description: error.message || \"Failed to upload license\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <FileText className=\"w-5 h-5\" />\r\n            Driver's License Verification\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Upload Section */}\r\n          <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center\">\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              accept=\"image/*,.pdf\"\r\n              onChange={handleFileChange}\r\n              className=\"hidden\"\r\n            />\r\n            <Upload className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-medium mb-2\">Upload Your License</h3>\r\n            <p className=\"text-muted-foreground mb-4\">\r\n              Take a clear photo of your driver's license or upload a PDF. We'll verify it before your booking.\r\n            </p>\r\n            <Button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              disabled={isUploading}\r\n              className=\"mb-2\"\r\n            >\r\n              {isUploading ? \"Processing...\" : \"Choose File\"}\r\n            </Button>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              Supports: JPG, PNG, PDF (max 5MB)\r\n            </p>\r\n          </div>\r\n\r\n          {/* Upload Button */}\r\n          {file && (\r\n            <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <FileText className=\"w-5 h-5 text-muted-foreground\" />\r\n                <span className=\"text-sm font-medium truncate max-w-[200px]\">\r\n                  {file.name}\r\n                </span>\r\n              </div>\r\n              <Button\r\n                onClick={handleUpload}\r\n                disabled={isUploading}\r\n                size=\"sm\"\r\n              >\r\n                {isUploading ? (\r\n                  <>\r\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    Uploading...\r\n                  </>\r\n                ) : (\r\n                  \"Upload License\"\r\n                )}\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </>\r\n  );\r\n};"],"names":["LicenseUpload","onUploaded","user","useAuth","isUploading","setIsUploading","useState","file","setFile","fileInputRef","useRef","handleFileChange","e","selectedFile","toast","handleUpload","fileExt","filePath","uploadError","supabase","license","insertError","error","jsx","Fragment","Card","CardHeader","jsxs","CardTitle","FileText","CardContent","Upload","Button","Loader2"],"mappings":"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"}