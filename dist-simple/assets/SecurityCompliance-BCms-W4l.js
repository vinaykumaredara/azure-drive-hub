import{c as X,r as l,G as D,w,j as e,B as d,t as j,v as f,y as E,z as U,s as k}from"./index-CvoPUybl.js";import{I as K}from"./input-DMosRNSl.js";import{S as T,a as F,b as I,c as R,d as i}from"./select-9Q-MVFrG.js";import{B as x}from"./badge-GQmDJRT9.js";import{F as b}from"./index-ZOP8ASaN.js";import{S as Y}from"./shield-DC0ZORfi.js";import{S as B}from"./search-CPezUsN-.js";import{D as Z}from"./download-hr67aklb.js";import{E as O}from"./eye-DIoCSlgP.js";import{S as ee}from"./LazyComponents-r_KJFKA4.js";import{U as se}from"./user-C4_4m0Ko.js";import{C as V}from"./car-CYTV7zau.js";import"./index-zKAJ-H7_.js";import"./check-C6nFDVMd.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=X("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),fe=()=>{const[g,z]=l.useState([]),[o,S]=l.useState([]),[N,M]=l.useState([]),[v,C]=l.useState([]),[P,G]=l.useState(!0),[y,_]=l.useState("audit"),[r,h]=l.useState(""),[u,L]=l.useState("all"),[p,A]=l.useState("all");l.useEffect(()=>{H(),J()},[]),l.useEffect(()=>{let s=g;r&&(s=s.filter(t=>t.description.toLowerCase().includes(r.toLowerCase())||t.user_email?.toLowerCase().includes(r.toLowerCase()))),u!=="all"&&(s=s.filter(t=>t.action===u)),S(s)},[g,r,u]),l.useEffect(()=>{let s=N;r&&(s=s.filter(t=>t.full_name?.toLowerCase().includes(r.toLowerCase())||t.email.toLowerCase().includes(r.toLowerCase()))),p!=="all"&&(s=s.filter(t=>t.kyc_status===p)),C(s)},[N,r,p]);const H=async()=>{try{const{data:s,error:t}=await D.from("audit_logs").select(`
          *,
          user:users(full_name, email)
        `).order("timestamp",{ascending:!1}).limit(100);if(t)throw t;const c=(s||[]).map(a=>({...a,user_email:a.user?.email||a.metadata?.user_email||"System"}));z(c),S(c)}catch(s){console.error("Error fetching audit logs:",s),w({title:"Error",description:"Failed to load audit logs",variant:"destructive"})}},J=async()=>{try{const{data:s,error:t}=await D.from("users").select("id, full_name, email, license_path, license_verified, created_at").not("license_path","is",null);if(t)throw t;const c=(s||[]).map(a=>({user_id:a.id,full_name:a.full_name,email:a.email||"",kyc_status:a.license_verified?"verified":"pending",kyc_documents:a.license_path?[a.license_path]:[],submitted_at:a.created_at||new Date().toISOString()}));M(c),C(c)}catch(s){console.error("Error fetching KYC statuses:",s),w({title:"Error",description:"Failed to load KYC statuses",variant:"destructive"})}finally{G(!1)}},W=()=>{const s=Array.isArray(o)?o:[],t=[["Timestamp","Action","Description","User","Metadata"],...s.map(n=>[new Date(n.timestamp).toISOString(),n.action,n.description,n.user_email||"N/A",JSON.stringify(n.metadata||{})])].map(n=>n.join(",")).join(`
`),c=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(c),m=document.createElement("a");m.href=a,m.download=`audit-logs-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(a),w({title:"Export Complete",description:"Audit logs exported successfully"})},$=s=>{switch(s){case"login":return e.jsx(te,{className:"w-4 h-4"});case"car_create":return e.jsx(V,{className:"w-4 h-4"});case"car_update":return e.jsx(V,{className:"w-4 h-4"});case"customer_suspend":return e.jsx(se,{className:"w-4 h-4"});case"settings_update":return e.jsx(ee,{className:"w-4 h-4"});default:return e.jsx(b,{className:"w-4 h-4"})}},q=s=>{switch(s){case"login":return"bg-blue-100 text-blue-800";case"car_create":return"bg-green-100 text-green-800";case"car_update":return"bg-yellow-100 text-yellow-800";case"customer_suspend":return"bg-red-100 text-red-800";case"settings_update":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},Q=s=>{switch(s){case"verified":return e.jsx(x,{className:"bg-success",children:"Verified"});case"pending":return e.jsx(x,{className:"bg-warning",children:"Pending"});case"rejected":return e.jsx(x,{variant:"destructive",children:"Rejected"});default:return e.jsx(x,{variant:"secondary",children:"Unknown"})}};return P?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Security & Compliance"}),e.jsx("p",{className:"text-muted-foreground",children:"Audit logs and KYC management"})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs(d,{variant:y==="audit"?"default":"ghost",onClick:()=>_("audit"),className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Audit Logs"]}),e.jsxs(d,{variant:y==="kyc"?"default":"ghost",onClick:()=>_("kyc"),className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"KYC Management"]})]}),y==="audit"?e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search audit logs...",value:r,onChange:s=>h(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{value:u,onValueChange:L,children:[e.jsx(F,{className:"w-40",children:e.jsx(I,{placeholder:"Action Type"})}),e.jsxs(R,{children:[e.jsx(i,{value:"all",children:"All Actions"}),e.jsx(i,{value:"login",children:"Login"}),e.jsx(i,{value:"car_create",children:"Car Create"}),e.jsx(i,{value:"car_update",children:"Car Update"}),e.jsx(i,{value:"customer_suspend",children:"Customer Suspend"}),e.jsx(i,{value:"settings_update",children:"Settings Update"})]})]}),e.jsx(d,{variant:"outline",onClick:()=>{h(""),L("all")},children:"Clear"}),e.jsxs(d,{variant:"outline",onClick:W,className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",o.length," of ",g.length," audit logs"]})]})}),e.jsxs(j,{children:[e.jsx(E,{children:e.jsx(U,{children:"Recent Audit Logs"})}),e.jsxs(f,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Timestamp"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Action"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-4",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Details"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs(k.tr,{initial:{opacity:0},animate:{opacity:1},className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm",children:new Date(s.timestamp).toLocaleString()})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(x,{className:q(s.action),children:e.jsxs("div",{className:"flex items-center gap-1",children:[$(s.action),e.jsx("span",{className:"capitalize",children:s.action.replace("_"," ")})]})})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm",children:s.description})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm",children:s.user_email||"System"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(d,{size:"sm",variant:"outline",children:e.jsx(O,{className:"w-4 h-4"})})})]},s.id))})]})}),o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No audit logs found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search or filter criteria"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search by name or email...",value:r,onChange:s=>h(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{value:p,onValueChange:A,children:[e.jsx(F,{className:"w-32",children:e.jsx(I,{placeholder:"Status"})}),e.jsxs(R,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"verified",children:"Verified"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"rejected",children:"Rejected"})]})]}),e.jsx(d,{variant:"outline",onClick:()=>{h(""),A("all")},children:"Clear"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",v.length," of ",N.length," KYC records"]})]})}),e.jsxs(j,{children:[e.jsx(E,{children:e.jsx(U,{children:"KYC Management"})}),e.jsxs(f,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Submitted"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Verified"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Documents"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(s=>e.jsxs(k.tr,{initial:{opacity:0},animate:{opacity:1},className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-medium",children:s.full_name||"Unnamed User"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm",children:s.email})}),e.jsx("td",{className:"py-3 px-4",children:Q(s.kyc_status)}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm",children:new Date(s.submitted_at).toLocaleDateString()})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm",children:s.verified_at?new Date(s.verified_at).toLocaleDateString():"Not verified"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"text-sm",children:[s.kyc_documents.length," document(s)"]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{size:"sm",variant:"outline",children:e.jsx(O,{className:"w-4 h-4"})})})})]},s.user_id))})]})}),v.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No KYC records found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search or filter criteria"})]})]})]})]})]})};export{fe as default};
//# sourceMappingURL=SecurityCompliance-BCms-W4l.js.map
