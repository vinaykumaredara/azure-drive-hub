import{r as d,j as e,t as b,y as F,z as w,v as y,B as x,w as l,G as c}from"./index-CvoPUybl.js";import{b as U}from"./input-DMosRNSl.js";import{F as h}from"./index-ZOP8ASaN.js";import{U as C}from"./upload-54noxj45.js";import{L as P}from"./loader-circle-DZ0-E_u0.js";const S=({onUploaded:g})=>{const{user:n}=U(),[r,m]=d.useState(!1),[t,u]=d.useState(null),i=d.useRef(null),j=s=>{const a=s.target.files?.[0];if(a){if(!a.type.startsWith("image/")&&a.type!=="application/pdf"){l({title:"Invalid File",description:"Please select an image file or PDF",variant:"destructive"});return}if(a.size>5*1024*1024){l({title:"File Too Large",description:"Please select a file smaller than 5MB",variant:"destructive"});return}u(a)}},v=async()=>{if(!(!t||!n)){m(!0);try{const s=t.name.split(".").pop(),o=`licenses/${`${n.id}/${Date.now()}.${s}`}`,{error:p}=await c.storage.from("license-uploads").upload(o,t,{upsert:!1});if(p)throw p;const{data:N,error:f}=await c.from("licenses").insert({user_id:n.id,storage_path:o,verified:!1}).select().single();if(f)throw await c.storage.from("license-uploads").remove([o]),f;l({title:"License Uploaded Successfully!",description:"Your license has been uploaded and is awaiting admin verification."}),g(N.id),u(null),i.current&&(i.current.value="")}catch(s){console.error("Upload error:",s),l({title:"Upload Failed",description:s.message||"Failed to upload license",variant:"destructive"})}finally{m(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs(b,{children:[e.jsx(F,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5"}),"Driver's License Verification"]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:i,type:"file",accept:"image/*,.pdf",onChange:j,className:"hidden"}),e.jsx(C,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Upload Your License"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Take a clear photo of your driver's license or upload a PDF. We'll verify it before your booking."}),e.jsx(x,{onClick:()=>i.current?.click(),disabled:r,className:"mb-2",children:r?"Processing...":"Choose File"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supports: JPG, PNG, PDF (max 5MB)"})]}),t&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px]",children:t.name})]}),e.jsx(x,{onClick:v,disabled:r,size:"sm",children:r?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):"Upload License"})]})]})]})})};export{S as LicenseUpload};
//# sourceMappingURL=LicenseUpload-QKeESwn2.js.map
